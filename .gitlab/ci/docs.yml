### DOCS STAGE JOBS ###

docs:
  stage: docs
  extends: 
    - .nox
    - .rules_main_mr_docs
  needs: []
  tags:
    - $DOCS_RUNNER_TAG
  script:
    - apt update && apt install graphviz -y
    - nox -e docs $DOCS_CLEAN
  artifacts:
    paths:
      - output/docs/.jupyter_cache/
      - output/docs/html/
    when: always

doclint:
  stage: docs
  extends:
    - .nox
    - .rules_main_mr_docs_skip_cache_update
  script:
    - nox -e doclint

doctest:
  stage: docs
  extends:
    - .nox
    - .rules_main_mr_docs_skip_cache_update
  script:
    - nox -e doctest

linkchecker:
  stage: docs
  extends: .rules_main_mr_docs_skip_cache_update
  needs: []
  image:
    name: ghcr.io/tcort/markdown-link-check:stable
    entrypoint: ['/bin/sh', '-c']
  script:
    - markdown-link-check --config docs/.markdown-link-check.json *.md
    - markdown-link-check --config docs/.markdown-link-check.json ./docs/source

markdownlint:
  stage: docs
  extends: .rules_main_mr_docs_skip_cache_update
  needs: []
  image:
    name: davidanson/markdownlint-cli2
    entrypoint: ['']
  script: |
    markdownlint-cli2 README.md || FAIL=1
    markdownlint-cli2 CONTRIBUTING.md || FAIL=1
    markdownlint-cli2 'docs/**/*.md' '#node_modules' || FAIL=1
    exit $FAIL
